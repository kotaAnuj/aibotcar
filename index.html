<!DOCTYPE html>
<html>
<head>
    <title>ESP32 Car Control - GitHub</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { 
            text-align: center; 
            font-family: Arial; 
            padding: 20px; 
            max-width: 600px; 
            margin: 0 auto;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        button { 
            padding: 18px 25px; 
            font-size: 18px; 
            margin: 10px; 
            border: none;
            border-radius: 8px; 
            cursor: pointer;
            transition: all 0.3s;
        }
        button:hover {
            transform: scale(1.05);
        }
        button:active {
            transform: scale(0.95);
        }
        #status { 
            margin: 20px; 
            padding: 15px;
            font-size: 18px; 
            font-weight: bold;
            border-radius: 8px;
            transition: all 0.3s;
        }
        .connected { 
            background: #4CAF50; 
            color: white; 
        }
        .disconnected { 
            background: #f44336; 
            color: white; 
        }
        .connection-info { 
            background: #e3f2fd; 
            padding: 20px; 
            border-radius: 10px; 
            margin: 20px 0; 
        }
        #log { 
            border: 1px solid #ddd; 
            padding: 15px; 
            margin: 20px 0; 
            min-height: 150px; 
            text-align: left; 
            border-radius: 8px; 
            background: #fafafa; 
            font-family: 'Courier New', monospace; 
            font-size: 14px;
        }
        input {
            width: 80%;
            padding: 12px;
            font-size: 16px;
            margin: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            text-align: center;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            border: 1px solid #ffeaa7;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöó ESP32 Car Controller</h1>
        <p>Control your ESP32 car from anywhere</p>
        
        <div class="warning">
            ‚ö†Ô∏è <strong>Important:</strong> This will only work if your ESP32 is accessible from the internet 
            (requires port forwarding and public IP). For local use, open the ESP32's IP directly in your browser.
        </div>

        <div class="connection-info">
            <h3>üîó Connection Settings</h3>
            <label>Enter ESP32 WebSocket URL:</label><br>
            <input type="text" id="wsUrl" placeholder="ws://192.168.1.100/ws" value="ws://192.168.1.100/ws">
            <br>
            <button onclick="connectWebSocket()" style="background: #28a745; color: white;">
                üîå Connect to ESP32
            </button>
            <button onclick="disconnectWebSocket()" style="background: #6c757d; color: white;">
                üîí Disconnect
            </button>
        </div>

        <div id="status" class="disconnected">
            üî¥ Status: Disconnected
        </div>

        <div>
            <h3>üéÆ Car Controls</h3>
            <div style="margin: 20px 0;">
                <button onclick="sendCommand('forward')" style="background: #2196F3; color: white; font-size: 20px; padding: 20px 35px;">
                    ‚¨ÜÔ∏è Forward
                </button>
            </div>
            
            <div style="margin: 20px 0;">
                <button onclick="sendCommand('left')" style="background: #FF9800; color: black; font-size: 18px; padding: 18px 30px;">
                    ‚¨ÖÔ∏è Left
                </button>
                <button onclick="sendCommand('right')" style="background: #FF9800; color: black; font-size: 18px; padding: 18px 30px;">
                    ‚û°Ô∏è Right
                </button>
            </div>
            
            <div style="margin: 20px 0;">
                <button onclick="sendCommand('backward')" style="background: #2196F3; color: white; font-size: 20px; padding: 20px 35px;">
                    ‚¨áÔ∏è Backward
                </button>
            </div>
            
            <div style="margin: 20px 0;">
                <button onclick="sendCommand('stop')" style="background: #f44336; color: white; font-size: 18px; padding: 15px 25px;">
                    ‚èπÔ∏è Emergency Stop
                </button>
            </div>
        </div>

        <div>
            <h3>üìù Connection Log</h3>
            <div id="log">Ready to connect... 
üëâ Enter your ESP32's IP address above and click "Connect to ESP32"
üëâ Example: ws://192.168.1.100/ws</div>
        </div>

        <div style="margin-top: 30px; padding: 15px; background: #e8f5e8; border-radius: 8px;">
            <h4>üí° Usage Tips:</h4>
            <p>‚Ä¢ Find ESP32 IP in Serial Monitor</p>
            <p>‚Ä¢ Use arrow keys for keyboard control</p>
            <p>‚Ä¢ Space bar = Emergency stop</p>
        </div>
    </div>

    <script>
        let socket = null;

        function log(message) {
            const logDiv = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logDiv.innerHTML = `<span style="color:#666;">[${timestamp}]</span> ${message}<br>` + logDiv.innerHTML;
        }

        function connectWebSocket() {
            const url = document.getElementById('wsUrl').value.trim();
            if (!url) {
                alert('‚ùå Please enter ESP32 WebSocket URL');
                return;
            }

            // Add /ws if not present
            let finalUrl = url;
            if (!url.endsWith('/ws')) {
                finalUrl = url + (url.endsWith('/') ? 'ws' : '/ws');
            }

            try {
                log(`üîÑ Connecting to: ${finalUrl}`);
                socket = new WebSocket(finalUrl);
                
                socket.onopen = () => {
                    document.getElementById('status').textContent = 'üü¢ Status: Connected to ESP32';
                    document.getElementById('status').className = 'connected';
                    log('‚úÖ WebSocket connection established successfully!');
                };
                
                socket.onclose = (event) => {
                    document.getElementById('status').textContent = 'üî¥ Status: Disconnected';
                    document.getElementById('status').className = 'disconnected';
                    log('üîå WebSocket connection closed');
                };
                
                socket.onerror = (error) => {
                    document.getElementById('status').textContent = 'üî¥ Status: Connection Failed';
                    document.getElementById('status').className = 'disconnected';
                    log('‚ùå WebSocket connection error - Check if ESP32 is running and accessible');
                    log('üí° Tip: Use the ESP32\'s local IP and ensure you\'re on the same network');
                };
                
                socket.onmessage = (event) => {
                    log(`üì• ESP32: ${event.data}`);
                };
                
            } catch (error) {
                log(`‚ùå Connection failed: ${error.message}`);
            }
        }

        function disconnectWebSocket() {
            if (socket) {
                socket.close();
                socket = null;
                log('üîí Manually disconnected from ESP32');
            }
        }

        function sendCommand(command) {
            if (socket && socket.readyState === WebSocket.OPEN) {
                socket.send(command);
                log(`üì§ Sent command: ${command}`);
            } else {
                alert('‚ùå Not connected to ESP32. Please connect first.');
                log(`‚ùå Failed to send "${command}" - No connection`);
            }
        }

        // Keyboard controls
        document.addEventListener('keydown', (event) => {
            const keyActions = {
                'ArrowUp': 'forward',
                'ArrowDown': 'backward',
                'ArrowLeft': 'left', 
                'ArrowRight': 'right',
                ' ': 'stop'
            };
            
            if (keyActions[event.key]) {
                sendCommand(keyActions[event.key]);
                event.preventDefault();
            }
        });

        // Auto-focus on input field
        document.getElementById('wsUrl').focus();

        // Display initial instructions
        log('üéÆ Keyboard controls enabled: Arrow keys = direction, Space = stop');
    </script>
</body>
</html>
